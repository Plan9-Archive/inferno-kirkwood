# status

boots, uses uart as console, rtc, runs dis programs, basic network
support (dhcp & mount working), might read some sd cards, can read
nand flash pages.

next steps:
- find out why jumping to eg dcflushinvalall hangs (perhaps the test & clean cache operation with r15 as arg is not right?)
- better dcache flushing
- l2 cache
- better nand support
- delay/microdelay calibration
- better sata support
- perform register file read after register writes to different registers
- lower power.  make sure we don't go into sdram self-refresh when we were just doing something useful.
- better sdio (error handling, interrupts, sd hooks, proper timeouts, mmc, use user buffer without crashing, better sdhc, and much more)
- more ethernet (fewer interrupts, more checks for idleness when configuring, phy)
- improve uart (mode setting)
- unbreak cesa.c, use it again
- more gpio, devgpio.c
- usb
- later: twsi,spi,i2s,pciexpress


# intro

this is to be a port of inferno to the kirkwood soc, and the
sheevaplug in particular/at first.

this is work in progress.


# instructions

make sure the contents of this directory are available in
$ROOT/os/kirkwood/.

make sure $ROOT/os/init/sheevainit.b is the same as
$ROOT/os/kirkwood/sheevainit.b (by copy, symlink or bind).

for compiling a kernel, the program "mkuimage" is needed.  build &
install it it by "cd mkuimage && mk install".

to compile a kernel, "mk install".  this will create "uisheeva" and
"uisheeva.gz" (the same kernels, but one is compressed).  these are
in the "uimage" format, as expected by the sheevaplug's bootloader
u-boot.


# booting

we can only boot from tftp for now.  set up a dhcp & tftp server.
the dhcp server should have a boot file name (the kernel, e.g.
uisheeva.gz) and a next server (the ip address of the tftp server)
configured.

after reset, hit some keys to prevent u-boot from auto-booting.
the following commands boot inferno:

	dhcp    # configure ethernet
	tftp    # fetch kernel
	bootm   # boot the kernel

inferno boots into a shell.  a few commands are available.  for
development, mdb is useful for reading/writing registers, e.g.:

	mdb -w /dev/sheevaregs

to make mdb do anything useful with the sheevaplugs registers (which
are configured at 0xf1000000, high bit set), you'll need to apply
the patch misc/mdb.b.diff.

to configure network with dhcp, and provide shells on the telnet port:

	run /netrc


# licence

the kernel code is released under the same licence as the inferno-os
code.

mkuimage is public domain, written by mechiel lukkien, reachable
at mechiel@ueber.net or mechiel@xs4all.nl.
